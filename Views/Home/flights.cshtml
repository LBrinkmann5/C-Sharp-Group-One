@model BookingPageModel
@{
    ViewData["Title"] = "Southwest Airlines - Flights";
}

<!DOCTYPE html>
<html>
<body>
    <div class="container">
        <div class="passengers bg-primary  p-3">
            <p class="text-white">Passengers: @ViewBag.PassengerCount</p>
            <input type="hidden" asp-for="Booking.PassengerCount" value="@ViewBag.PassengerCount" />
        </div>

        <table class="table table-borderless table-striped text-center">
            <!--Populate with Flights-->
            <thead>
                <th>Flight Number</th>
                <th>Departure Time</th>
                <th>Arrival Time</th>
                <th>Price</th>
                <th>Fast Pass Availability</th>
                <th>Use Fast Pass?</th>
                <th></th>
            </thead>
            <tbody>
                
                    @foreach (var flight in Model.FlightsList)
                    {
                    <tr>
                        <td>@flight.FlightNumber</td>
                        <td>@flight.DepartureTime.ToString("HH:mm")</td>
                        <td>@flight.ArrivalTime.ToString("HH:mm")</td>
                        <td>@flight.Price.ToString("C")</td>
                        <td>@flight.FastPassAvailable</td>
                        <td>@if(flight.FastPassAvailable == false)
                            {
                                <input  type="checkbox"  disabled />
                            }
                            else
                            {
                                <input type="checkbox" class="fastpass-checkbox" id="fastpass_@flight.FlightId" data-flightid="@flight.FlightId" />
                            }
                        </td>
						<td><a href="@Url.Action("bookingPayment", "Home", new { flightId = flight.FlightId, price = flight.Price })" class="btn btn-primary book-flight" data-flightid="@flight.FlightId">Book Flight</a></td>
                    </tr>
					}

                
            </tbody>
        </table>
        </div>
	@section Scripts {
		<script>
            document.querySelectorAll('.book-flight').forEach(function(link)
            {
                link.addEventListener('click', function(e){
                    e.preventDefault();
                    var flightId = this.getAttribute('data-flightid');
                    var checkbox = document.getElementById('fastpass_' + flightId);
                    var useFastPass = checkbox && checkbox.checked ? 'true' : 'false';

                    // Use the URL API for safer parameter handling
                    var url = new URL(this.href, window.location.origin);
                    url.searchParams.set('useFastPass', useFastPass);
                    window.location.href = url.toString();
                });
            });
        </script>
	}
    </body>
</html>